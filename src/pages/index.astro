---
import "../styles/global.css";
import Topbar from "../components/Topbar.astro";
const BASE = import.meta.env.BASE_URL;
---

<html lang="en" data-theme="dark" data-base={BASE}>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width" />
    <link rel="icon" type="image/svg+xml" href={BASE + 'favicon.svg'} />
    <link rel="shortcut icon" type="image/svg+xml" href={BASE + 'favicon.svg'} />
    <title>alive</title>
    <style>
      /* Only the bounce positioning lives here; visuals come from your global .status styles */
      .floating {
        position: fixed;
        left: 12vw;
        top: 18vh;
        margin: 0;
        z-index: 40;
      }
    </style>
  </head>
  <body>
    <div id="boot" class="boot">
      <pre id="boot-lines" class="boot-lines"></pre>
    </div>
    <div id="flash" class="flash" aria-hidden="true"></div>
    <div id="reveal" class="reveal" aria-hidden="true">
      <div class="bar bar-left"></div>
      <div class="bar bar-right"></div>
    </div>

    <Topbar />

    <main class="wrap">
      <h1 id="hello" class="type-caret"></h1>
      <p>I’m a Junior in high school, and I create stuff</p>

      <section aria-label="my socials" class="ticker b-solid">
        <div class="ticker-head">my socials</div>

        <div class="ticker-viewport">
          <div class="ticker-track">
            <span class="item"><a href="https://github.com/ChanminK" target="_blank" rel="noreferrer">github.com/ChanminK</a></span>
            <span class="sep">•</span>
            <span class="item">@Iamalive (slack)</span>
            <span class="sep">•</span>
            <span class="item">thisischanmin@gmail.com</span>
            <span class="sep">•</span>
            <span class="item"><a href="https://github.com/ChanminK" target="_blank" rel="noreferrer">github.com/ChanminK</a></span>
            <span class="sep">•</span>
            <span class="item">@Iamalive (slack)</span>
            <span class="sep">•</span>
            <span class="item">thisischanmin@gmail.com</span>
          </div>

          <div class="ticker-track" aria-hidden="true">
            <span class="item"><a href="https://github.com/ChanminK" target="_blank" rel="noreferrer">github.com/ChanminK</a></span>
            <span class="sep">•</span>
            <span class="item">@Iamalive (slack)</span>
            <span class="sep">•</span>
            <span class="item">thisischanmin@gmail.com</span>
            <span class="sep">•</span>
            <span class="item"><a href="https://github.com/ChanminK" target="_blank" rel="noreferrer">github.com/ChanminK</a></span>
            <span class="sep">•</span>
            <span class="item">@Iamalive (slack)</span>
            <span class="sep">•</span>
            <span class="item">thisischanmin@gmail.com</span>
          </div>
        </div>
      </section>
    </main>

    <script is:inline>
      (function(){
        var boot   = document.getElementById('boot');
        var out    = document.getElementById('boot-lines');
        var flash  = document.getElementById('flash');
        var reveal = document.getElementById('reveal');
        if (!boot || !out || !flash || !reveal) return;

        var lines = ["> booting aliveOS...","> loading thoughts...","> ready."];

        var charDelay = 35, linePause = 350, reduce = false;
        try { reduce = window.matchMedia && window.matchMedia("(prefers-reduced-motion: reduce)").matches; } catch(e){}
        if (reduce){ charDelay = 0; linePause = 120; }

        var li=0, ci=0;

        function typeChar(){
          if (li >= lines.length){
            boot.classList.add("boot--hide");

            if (!reduce){
              flash.classList.add("flash--go");
              setTimeout(function(){ reveal.classList.add("reveal--go"); }, 110);
              setTimeout(finishBoot, 600);
            } else {
              finishBoot();
            }
            return;
          }
          var text = lines[li];
          if (ci === 0 && li > 0) out.appendChild(document.createTextNode("\n"));
          out.appendChild(document.createTextNode(text.charAt(ci++)));
          if (ci < text.length) setTimeout(typeChar, charDelay);
          else { ci = 0; li++; setTimeout(typeChar, linePause); }
        }

        function finishBoot(){
          try { flash.remove(); reveal.remove(); } catch(e){}
          document.dispatchEvent(new CustomEvent("boot:done"));
        }

        typeChar();
      })();
    </script>

    <script is:inline>
      (function(){
        document.addEventListener("boot:done", function(){
          var el = document.getElementById("hello");
          if (!el) return;
          var text = "Hi, I'm Alive";
          var i = 0, delay = 45;
          try { if (window.matchMedia && window.matchMedia("(prefers-reduced-motion: reduce)").matches) delay = 0; } catch(e){}
          (function next(){ if (i < text.length){ el.textContent += text.charAt(i++); setTimeout(next, delay); } else { el.classList.remove("type-caret"); } })();
        });
      })();
    </script>
    <section style="margin-block-end: clamp(3rem, 8vh, 10rem);"></section>

    <div
      class="floating status-wrap"
      data-key="statusbox-now"
      data-mode="bounce"
      data-label="Now Playing"
      data-value="lo-fi study loop"
    >
      <div class="status" role="status" aria-live="polite">
        <span class="tag">Now Playing:</span>&nbsp;<span class="value">lo-fi study loop</span>
        <button class="x" aria-label="Close status" data-close>&times;</button>
      </div>
    </div>

    <script is:inline>
      (function(){
        var root = document.currentScript && document.currentScript.previousElementSibling;
        if (!root) return;

        var key  = root.getAttribute('data-key')  || 'statusbox';
        var mode = root.getAttribute('data-mode') || 'docked';
        var box  = root.querySelector('.status');
        var btn  = root.querySelector('[data-close]');

        if (sessionStorage.getItem(key + '-closed') === '1') {
          root.style.display = 'none';
          return;
        }

        var stop = function(){}; 

        if (btn){
          btn.addEventListener('click', function(){
            sessionStorage.setItem(key + '-closed', '1');
            try { stop(); } catch(e){}
            root.style.display = 'none';
          });
        }

        if (mode !== 'bounce' || !box) return;

        var raf = 0;
        var x = Math.max(8, root.offsetLeft || window.innerWidth  * 0.12);
        var y = Math.max(8, root.offsetTop  || window.innerHeight * 0.18);
        var vx = 1.1, vy = 1.0; 
        var M = 8;
        var reduce = false;
        try { reduce = window.matchMedia('(prefers-reduced-motion: reduce)').matches; } catch(e){}

        function frame(){
          var r  = box.getBoundingClientRect();
          var bw = r.width, bh = r.height;

          x += vx; y += vy;
          if (x <= M || x + bw >= window.innerWidth  - M) vx *= -1;
          if (y <= M || y + bh >= window.innerHeight - M) vy *= -1;

          root.style.left = Math.max(M, Math.min(window.innerWidth  - bw - M, x)) + 'px';
          root.style.top  = Math.max(M, Math.min(window.innerHeight - bh - M, y)) + 'px';

          raf = window.requestAnimationFrame(frame);
        }
        function start(){ if (!reduce && !raf) raf = window.requestAnimationFrame(frame); }
        stop = function(){ if (raf) window.cancelAnimationFrame(raf); raf = 0; };

        var dragging=false, dx=0, dy=0;
        box.addEventListener('mousedown', function(e){
          dragging=true; stop();
          var rr = root.getBoundingClientRect();
          dx = e.clientX - rr.left; dy = e.clientY - rr.top;
          document.body.style.userSelect='none';
        });
        window.addEventListener('mousemove', function(e){
          if (!dragging) return;
          root.style.left = (e.clientX - dx) + 'px';
          root.style.top  = (e.clientY - dy) + 'px';
        });
        window.addEventListener('mouseup', function(){
          if (!dragging) return;
          dragging=false; document.body.style.userSelect='';
          start();
        });

        document.addEventListener('visibilitychange', function(){ document.hidden ? stop() : start(); });
        window.addEventListener('blur',  stop);
        window.addEventListener('focus', start);

        start();
      })();
    </script>

    <footer class="site-footer">made with astro + I need coffee</footer>
  </body>
</html>