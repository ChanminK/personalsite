---
import "../../styles/global.css";
import Topbar from "../../components/Topbar.astro";

interface Front {
  title: string;
  date: string;
  summary?: string;
  tags?: string[];
}

const { slug } = Astro.params;
const modules = import.meta.glob("../../content/posts/*.md", { eager: true }) as Record<
  string,
  { frontmatter: Front; default: any }
>;

const entry = Object.entries(modules).find(([path]) => path.endsWith(`${slug}.md`));
if (!entry) {
  throw new Error(`Post not found: ${slug}`);
}
const [, mod] = entry;
const { title, date, tags = [] } = mod.frontmatter;
const Content = mod.default;
---

<html lang="en" data-theme="dark">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width" />
    <title>{title} · alive</title>
  </head>
  <body>
    <Topbar />

    <main class="wrap">
      <h1 style="margin-bottom:4px">{title}</h1>
      <div class="repo-meta" style="margin-bottom:12px">
        <span>{new Date(date).toLocaleDateString()}</span>
        {tags.length > 0 && <span>{tags.map((t) => `#${t}`).join(" ")}</span>}
      </div>

      <article class="card">
        <Content />
      </article>

      <p style="margin-top:16px">
        <a class="tab" href="/blog">← back to blog</a>
      </p>
    </main>

    <footer class="site-footer">made with astro + Need coffee</footer>
  </body>
</html>
